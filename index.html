<!DOCTYPE html>
<html>
<head>
	<title>Denny's Blog | Better Late Than Never - Start From Little Thing - Just Do It</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<link rel="stylesheet" href="/css/rundown.css" type="text/css" media="screen" />

	<script type='text/javascript' src='/js/jquery.js'></script>
	<script type='text/javascript' src='/js/rundown-script.js'></script>

	<!--[if IE]>
		<link href="/css/ie.css" rel="stylesheet" type="text/css" />
	<![endif]-->
	
</head>

<body class="home blog custom-background">

	<div id="wrapper">
	
		<div id="header">
	<div id="header-inner">
		<h1><a href="/">Denny's Blog</a></h1>
		<p class="description">Better Late Than Never - Start From Little Thing - Just Do It</p>
	</div>
	<div id="primarynav" class="menu-news-container">
		<ul class="menu">
			<li class="menu-item"><a href="/index.html">Post</a></li>
			<li class="menu-item"><a href="/about.html">About</a></li>
		</ul>
	</div>		
	<div class="clear"></div>	
</div>
		
		<!--/#main-->		
		<div id="main">
			<div id="content">
				
	<div class="post">
	<div class="post-head">
		<h2 class="post-title"><a href="/IE/windows-ie-issue.html">IE特殊处理三则</a></h2>
		<div class="meta">
			<span class="alt-font">Posted in &nbsp; 
			
				<a href="/categories/IE/index.html">IE</a>
			 &nbsp; 
			at 2013-03-20 </span>
			<span class="comments-link">
			      <a href="/IE/windows-ie-issue.html#disqus_thread"></a>
			</span>
		</div>
	</div>
	<div class="entry">
		<p>做过前台开发的人员，或多或少都会碰到IE的兼容问题。</p>




<p>最近在给<a href="http://www.hupo.tv">琥珀网</a>做首页的时候，也碰到了IE显示问题。主要有三个问题：</p>




<ul>
<li>节目表单无法正确显示</li>
<li>IE7下，首页的jwplayer位置不正确</li>
<li>首页中，各频道图片之间的间距显示不正确</li>
</ul>




<p>有问题不可怕，可怕的是找不到问题所在，以及没有跟踪的办法。</p>




<hr />




<p>琥珀网中的节目表单使用一个叫<a href="http://almende.github.com/chap-links-library/">CHAP Links Library</a>的timeline插件实现json数据动态加载。这个功能在FF，Chrome，Safari中都能正确工作，只有在IE中，无法显示节目单。</p>




<p>起初我一点头绪都没有，只要在js代码中增加alert语句来调试，唯一得到的就是代码可以正确的执行，就是结果不显示。</p>




<p>只好在IE的开发人员工具F12的帮助下，给js代码设置断点，搜索问题。</p>




<p>在timeline.js的draw方法中'this.setData(data)'设置一个断点，查看一下data数据，果然在这里发现问题，data数据中所有的日期字段都是"Undefined"。回到Chrome中查询对应的数据，发现这些日期都没有问题。</p>




<pre><code>links.Timeline.prototype.draw = function(data, options) {
  this.setOptions(options);

   // read the data
   this.setData(data);

   // set timer range. this will also redraw the timeline
   if (options &amp;&amp; (options.start || options.end)) {
       this.setVisibleChartRange(options.start, options.end);
   }
   else if (this.firstDraw) {
       this.setVisibleChartRangeAuto();
   }

   this.firstDraw = false;
};
</code></pre>




<p>这些日期数据都是ruby传给js的，形式如，str = 'Wed Mar 20 16:05:05 +0800 2013'，然后把这个字符串传递给js的Date函数。</p>




<pre><code>var time = new Date(str);  
// str ='Wed Mar 20 16:05:05 +0800 2013'
</code></pre>




<p>上面的这句话在Chrome，FF，Safari中都能正确的生成JS下的日期，只有IE下无法实现。为了搞清楚，特意google一下JS中Date的构造函数，<a href="http://www.w3schools.com/jsref/jsref_obj_date.asp">参见</a></p>




<p>原来JS中，Date对象的定义有如下几种形式：</p>




<pre><code>var d = new Date();

var d = new Date(milliseconds);

var d = new Date(dateString);

var d = new Date(year, month, day, hours, minutes, seconds, milliseconds);
</code></pre>




<p>其中dateString,只支持如下几种形式，当然不局限于如下形式：</p>




<pre><code>October 13,1975 11:13:00

October 13,1975 11:13

October 13,1975

2010-06-09 15:20:00

2010-06-09 15:20

2010-06-09

2010-06

2010
</code></pre>




<p>对于IE来说，上面的'Wed Mar 20 16:05:05 +0800 2013'这种形式是不支持的，所以改为Date(milliseconds)，问题就迎刃而解。</p>




<hr />




<p>关于jwplayer位置不正确的问题，首先了解，jwplayer.setup("div_id")的方法，会生成如下代码：</p>




<p>原代码</p>




<pre><code>&lt;div id="div_id"&gt;jwplayer&lt;/div&gt;
</code></pre>




<p>新代码</p>




<pre><code>&lt;div id='div_id_wrapper'&gt;&lt;object id='div_id'&gt;...&lt;/object&gt;&lt;/div&gt;
</code></pre>




<p>所以在写css的时候，可以通过设置div_id_wrapper这个div样式来实现想要的效果。</p>




<p>本例中，还涉及到position:relative在IE7下不工作的问题。具体解决方案，<a href="http://snook.ca/archives/html_and_css/position_relative_overflow_ie/">参见</a>，解释的很清楚。</p>




<hr />




<p>关于第三个问题，没有修改任何css代码，只是在网页的头部添加了&lt;!DOCTYPE> transitional DTD。</p>




<pre><code>&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "
</code></pre>




<p>http://www.w3.org/TR/html4/loose.dtd"></p>


	</div>
</div>
<div class="clear"></div>	

	<div class="post">
	<div class="post-head">
		<h2 class="post-title"><a href="/Drupal/drupal_show_list.html">Drupal实现节点列表菜单</a></h2>
		<div class="meta">
			<span class="alt-font">Posted in &nbsp; 
			
				<a href="/categories/Drupal/index.html">Drupal</a>
			 &nbsp; 
			at 2013-03-18 </span>
			<span class="comments-link">
			      <a href="/Drupal/drupal_show_list.html#disqus_thread"></a>
			</span>
		</div>
	</div>
	<div class="entry">
		<p>Drupal有搜索功能，只要在搜索表单中输入条件，点击搜索就可以得到结果列表页面。可是在开发网站的过程中，难免会有这样的需求，一个菜单或者连接实现一个查询。最近在建立<a href="http://www.asischia.com">Asischina</a>这个网站的时候，就需要实现这个菜单。</p>




<p>具体需求，这个网站中，有一个Node Type是News的节点，想通过/asischina/list/news来得到所有的News列表，并希望结果页面有分页功能。</p>




<p>起初我觉得这个功能不复杂，肯定有Module实现了它，于是就去<a href="http://www.drupal.org">Drupal</a>官方搜索，结果是令人失望的，两天都没有找到合适的Module。</p>




<p>于是决定自己写个Module实现这个菜单。</p>




<ul>
<li><p>定义菜单项,实现hook_menu函数</p>

<pre><code>$items['asischina/list/%'] = array(
  'title' =&gt; 'Content Type list',
  'page callback' =&gt; 'asischina_list_for_content_type_page',
  'page arguments' =&gt; array(2),
  'access callback' =&gt; TRUE, //array('access content'),
  'type' =&gt; MENU_CALLBACK,
);
return $items;
</code></pre></li>
<li><p>实现查询功能，asischina_list_for_content_type_page($content_type)</p>

<pre><code>$query = 'SELECT nid FROM {node} where type = "'. $content_type .'" ORDER BY nid desc ';

$count_query = "SELECT COUNT(*) FROM (" . $query . ") AS count_query";

$result = pager_query($query, 10, 0, $count_query);

$output = "";

while ($item = db_fetch_object($result)) {        
  // Build the node body.
  $node = node_load($item-&gt;nid);
  $output .= node_view($node,true);
}

$output .= theme('pager', NULL, 10, 0);

return $output;
</code></pre></li>
</ul>




<p>最终代码虽然简单，过程可是很曲折的。</p>




<p>首先，定义菜单项，需要注意page argements与通配符的对应关系，本例中，array(2)对应通配符。</p>




<p>asischina  -- array(0)
list -- array(1)
% -- array[2]</p>




<p>再次，pager_query函数实现分页查询</p>




<p>然后， node_view实现node正确显示，按列表结果展示，不是按full page展示节点</p>




<p>最后， theme('pager',Null,10,0)展示页面中的分页器</p>




<p>纪录这些学习过程。</p>




<hr />




<p><em>问：github如何得到除master以外的分支</em></p>




<p><em>答：第一次clone下来都是master,用如下语句可以得到其他分支</em></p>




<p><code>git checkout -b xxx origin/xxx</code></p>


	</div>
</div>
<div class="clear"></div>	

	<div class="post">
	<div class="post-head">
		<h2 class="post-title"><a href="/Google/add_google_marked_map.html">如何在网站中添加有城市标记的Google地图</a></h2>
		<div class="meta">
			<span class="alt-font">Posted in &nbsp; 
			
				<a href="/categories/Google/index.html">Google</a>
			 &nbsp; 
			at 2013-03-14 </span>
			<span class="comments-link">
			      <a href="/Google/add_google_marked_map.html#disqus_thread"></a>
			</span>
		</div>
	</div>
	<div class="entry">
		<p>好多网站都会有这样的需求，展示一个地图，上面标记出一些地名或者城市。如下图所示。</p>




<p><img src="/images/map.png" alt="map_id" /></p>




<p>众所周知，Google和baidu都提供了地图服务，象上述这个小功能肯定提供了API来实现。本人没有开发过GIS，上网搜索后，找到了一个解决办法，纪录之，已供学习用。<a href="https://developers.google.com/maps/articles/v2tov3?hl=en">参考</a></p>




<ul>
<li>首先在Html的<head>标记中添加如下语句</li>
</ul>




<p><code>&lt;script src="//maps.googleapis.com/maps/api/js?sensor=false&amp;key=Your_API_Key" type="text/javascript"&gt;&lt;/script&gt;</code></p>




<ul>
<li><p>然后添加初始化地图的js函数initialize()</p>

<pre><code>var map = new google.maps.Map(
  document.getElementById('map_canvas'), {
    center: new google.maps.LatLng(39.943096343663754,116.4474801854858),
    zoom: 11,
    mapTypeId: google.maps.MapTypeId.ROADMAP
});

var marker = new google.maps.Marker({
      position: new google.maps.LatLng(39.943096343663754,116.4474801854858),
      map: map
});

var marker1 = new google.maps.Marker({
      position: new google.maps.LatLng(39.99855,116.470013),
      map: map
});
</code></pre>

<p>  <code>google.maps.event.addDomListener(window, 'load', initialize);</code></p></li>
<li><p>接下来，在页面中添加map的div，代码如下</p></li>
</ul>




<p><code>&lt;div id="map_canvas"&gt;&lt;/div&gt;</code></p>




<p>这样就可以在网页中看到有标志的Google地图了。</p>




<p>那么如何得到某个城市或者地方的准确经纬度呢？可以访问这个网址，输入地名，就可以得到对应的经纬度。</p>




<p><a href="http://www.gpsspg.com/maps.htm">http://www.gpsspg.com/maps.htm</a></p>


	</div>
</div>
<div class="clear"></div>	



<div class="navigation">
	
	
		<span class="nav-next"><a href="/page2">Next</a></span>
			
</div>
			</div>			
			<div id="sidebar">	
	<div id="recent-posts" class="widget">
		<h2>Recent Posts</h2>		
		<ul>
			
				<li><strong><a href="/IE/windows-ie-issue.html">IE特殊处理三则</a></strong></li>
			
				<li><strong><a href="/Drupal/drupal_show_list.html">Drupal实现节点列表菜单</a></strong></li>
			
				<li><strong><a href="/Google/add_google_marked_map.html">如何在网站中添加有城市标记的Google地图</a></strong></li>
			
				<li><strong><a href="/TechExper/update_my_website_2.html">我的建站经历(续)</a></strong></li>
			
				<li><strong><a href="/TechExper/update_my_website.html">我的建站经历</a></strong></li>
			
				<li><strong><a href="/English/english_breakfast.html">English Breakfast</a></strong></li>
			
				<li><strong><a href="/English/what-is-that.html">What is that</a></strong></li>
			
				<li><strong><a href="/Study/fibanocci_function.html">Fibanocci Function</a></strong></li>
			
				<li><strong><a href="/English/english_study_3.html">English Learning 3</a></strong></li>
			
				<li><strong><a href="/English/english_study_2.html">English Learning 2</a></strong></li>
			
				<li><strong><a href="/English/english_study_1.html">English Learning 1</a></strong></li>
			
				<li><strong><a href="/makefile_introduction.html">What is makefile?</a></strong></li>
			
				<li><strong><a href="/Erlang/erlang_study.html">Erlang Study</a></strong></li>
			
				<li><strong><a href="/Erlang/erlang_linux.html">Erlang Linux</a></strong></li>
			
		</ul>
	</div>
	<div id="categories" class="widget">
		 <h2>Categories</h2><ul><li><a href="/categories/Drupal/index.html"><strong>Drupal (1)</strong></a></li><li><a href="/categories/Study/index.html"><strong>Study (1)</strong></a></li><li><a href="/categories/TechExper/index.html"><strong>TechExper (2)</strong></a></li><li><a href="/categories/Erlang/index.html"><strong>Erlang (2)</strong></a></li><li><a href="/categories/IE/index.html"><strong>IE (1)</strong></a></li><li><a href="/categories/Google/index.html"><strong>Google (1)</strong></a></li><li><a href="/categories/English/index.html"><strong>English (5)</strong></a></li></ul>
	</div>
	<div id="archives" class="widget">
		<h2>Archives</h2><ul><li><a href="/archives/2011/3/index.html"><strong>2011/3 (5 posts)</strong></a></li><li><a href="/archives/2013/3/index.html"><strong>2013/3 (5 posts)</strong></a></li><li><a href="/archives/2011/5/index.html"><strong>2011/5 (2 posts)</strong></a></li><li><a href="/archives/2011/8/index.html"><strong>2011/8 (1 posts)</strong></a></li><li><a href="/archives/2011/9/index.html"><strong>2011/9 (1 posts)</strong></a></li></ul>
	</div>					
</div>

			<div class="clear"></div>			
		</div>
		
		<div id="footer">
	<div class="footer-inner">
		<span class="footcreditleft">&copy; 2013 - Denny</span>
		<span class="footcreditright"><a href="http://www.kharissulistiyono.com/wp-labs/rundown-wordpress-theme/">Rundown</a>  - Proudly powered by <a href="http://denny2trasy.github.com/about.html">Denny</a></span>
		<div class="clear"></div>
	</div>	
</div>
	
	</div>
	
	<a href="#" class="scrollup">Scroll to top</a>
	
	<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dennysblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    
		
</body>


</html>